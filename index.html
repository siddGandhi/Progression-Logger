<!DOCTYPE html>
<html>
  <head>
    <title>Progression Log</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        font-family: sans-serif;
        max-width: 400px;
        margin: 40px auto;
        padding: 20px;
      }

      input,
      button {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        font-size: 1rem;
        border-radius: 6px;
        border: 1px solid #ccc;
      }

      button {
        background-color: #4caf50;
        color: white;
        border: none;
        cursor: pointer;
      }

      #suggestions {
        border: 1px solid #ccc;
        border-radius: 0 0 6px 6px;
        border-top: none;
        background: #fff;
        max-height: 150px;
        overflow-y: auto;
        display: none;
        position: absolute;
        width: 100%;
        z-index: 10;
      }

      .suggestion-item {
        padding: 8px 10px;
        cursor: pointer;
      }

      .suggestion-item:hover {
        background-color: #f0f0f0;
      }

      .field-container {
        position: relative;
      }
    </style>
  </head>
  <body>
    <h2>Workout Logger</h2>
    <form id="logForm">
      <div class="field-container">
        <input
          type="text"
          id="movement"
          placeholder="Movement"
          autocomplete="off"
          required
        />
        <div id="suggestions"></div>
      </div>
      <input type="number" id="reps" placeholder="Reps" required />
      <input type="number" id="weight" placeholder="Weight" required />
      <button type="submit">Log Workout</button>
    </form>
    <p id="response"></p>

    <script type="module">
      import { officialMovements } from "./movements.js";
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyB1stVLEI3K_m2nT7oidXt46rwGaIIxnbE",
        authDomain: "progression-logger-bd54a.firebaseapp.com",
        projectId: "progression-logger-bd54a",
        storageBucket: "progression-logger-bd54a.appspot.com",
        messagingSenderId: "191611716470",
        appId: "1:191611716470:web:8c88bb767fe6aa0aa7f057",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      const form = document.getElementById("logForm");
      const movementInput = document.getElementById("movement");
      const repsInput = document.getElementById("reps");
      const weightInput = document.getElementById("weight");
      const response = document.getElementById("response");
      const suggestionsBox = document.getElementById("suggestions");

      movementInput.addEventListener("input", () => {
        const query = movementInput.value.trim().toLowerCase();
        if (!query) {
          suggestionsBox.style.display = "none";
          return;
        }

        const matches = officialMovements.filter((name) =>
          name.toLowerCase().includes(query)
        );

        if (matches.length === 0) {
          suggestionsBox.style.display = "none";
          return;
        }

        suggestionsBox.innerHTML = "";
        matches.forEach((match) => {
          const item = document.createElement("div");
          item.className = "suggestion-item";
          item.textContent = match;
          item.onclick = () => {
            movementInput.value = match;
            suggestionsBox.style.display = "none";
          };
          suggestionsBox.appendChild(item);
        });

        suggestionsBox.style.display = "block";
      });

      document.addEventListener("click", (e) => {
        if (!movementInput.contains(e.target)) {
          suggestionsBox.style.display = "none";
        }
      });

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const enteredMovement = movementInput.value.trim();
        const isValid = officialMovements.includes(enteredMovement);

        if (!isValid) {
          response.textContent =
            "❌ Invalid movement. Please select from the list.";
          return;
        }

        const doc = {
          movement: enteredMovement,
          reps: Number(repsInput.value),
          weight: Number(weightInput.value),
          date: new Date().toISOString(),
        };

        try {
          await addDoc(collection(db, "workouts"), doc);
          response.textContent = "✅ Workout logged!";
          form.reset();
          suggestionsBox.style.display = "none";
        } catch (err) {
          response.textContent = "❌ Error: " + err.message;
        }
      });
    </script>
  </body>
</html>
